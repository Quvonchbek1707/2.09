<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Balsamiq+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Lobster&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="./css/main.css">
	<title>LOOK ORDER</title>
</head>
<body>
	<div class="container">
		<div class="navbar">
			<div class="navbar-top">
				<a href="#">
					<img src="./img/logo.svg" alt="logo" height="50">
				</a>
			</div>
			<div class="navbar-main">
				<ul class="customers-list">
					<!-- mock user. buni keyin o'chirib tashlang -->
					<li class="customer-item">
						<span class="customer-name">Sobir</span>
						<a class="customer-phone" href="tel:+998941049914">+998912345678</a>
					</li>
					<li class="customer-item">
						<span class="customer-name">Akobir</span>
						<a class="customer-phone" href="tel:+998901234567">+998901234567</a>
					</li>
					<li class="customer-item">
						<span class="customer-name">Asror</span>
						<a class="customer-phone" href="tel:+998330711707">+998330711707</a>
					</li>
					<li class="customer-item">
						<span class="customer-name">Aziz</span>
						<a class="customer-phone" href="tel:+998330711708">+998330711708</a>
					</li>
					<li class="customer-item">
						<span class="customer-name">Laziz</span>
						<a class="customer-phone" href="tel:+998330711703">+998330711703</a>
					</li>
					<li class="customer-item">
						<span class="customer-name">Daler</span>
						<a class="customer-phone" href="tel:+998982344534">+998982344534</a>
					</li>

				</ul>
			</div>
			<div class="navbar-footer">
				<form id="userAdd">
					<input id="usernameInput" type="text" placeholder="username..." required>
					<input id="telephoneInput" type="tel" placeholder="telephone..." required>
					<button type="submit">
						<img src="https://img.icons8.com/pastel-glyph/64/000000/add-user-male--v2.png" alt="plus-icon">
					</button>
				</form>
			</div>
		</div>
		<div class="main">
			<div class="main-headers">
				<div class="cutomer-id-wrapper">
					<span>client id:</span>
					<span id="clientId">1</span>
				</div>
				<h1 id="userHeader" class="customer-name">Sobir</h1>
			</div>
			<div class="main-orders">
				<ul class="orders-list">
					<!-- mock order. Keyin o'chirib tashlang -->
					<li class="order-item">
						<img src="./img/cola.jpeg">
						<div>
							<span class="order-name">Cola</span>
							<span class="order-count">2</span>
						</div>
					</li>

					<li class="order-item">
						<img src="./img/fanta.jpeg">
						<div>
							<span class="order-name">Fanta</span>
							<span class="order-count">1</span>
						</div>
					</li>

				</ul>
			</div>
			<div class="main-footer">
				<form id="foodsForm">
					<select id="foodsSelect">
						<!-- mock food. keyin o'chirib tashlang -->
						<option value="1">Cola</option>
						<option value="2">Fanta</option>
					</select>
					<input id="foodsCount" type="number" placeholder="count" required>
					<button type="submit">
						<img src="https://img.icons8.com/plasticine/100/000000/plus-math.png" alt="plus-button" height="35">
					</button>
				</form>
			</div>
		</div>
	</div>
	<script>
		// Fetch and display users
		fetch('http://localhost:3000/users/all')
			.then(response => response.json())
			.then(users => {
				const customersList = document.querySelector('.customers-list');
				customersList.innerHTML = ''; // Clear mock data
				users.forEach(user => {
					const li = document.createElement('li');
					li.className = 'customer-item';
					li.innerHTML = `
						<span class="customer-name">${user.name}</span>
						<a class="customer-phone" href="tel:${user.phone}">${user.phone}</a>
					`;
					li.addEventListener('click', () => {
						document.getElementById('clientId').textContent = user.id;
						document.getElementById('userHeader').textContent = user.name;
						// Fetch orders for this user
						fetchOrders(user.id);
					});
					customersList.appendChild(li);
				});
			})
			.catch(error => console.error('Error fetching users:', error));

		function fetchOrders(userId) {
			fetch('http://localhost:3000/orders/all')
				.then(response => response.json())
				.then(orders => {
					const userOrders = orders.filter(order => order.userId === userId);
					const ordersList = document.querySelector('.orders-list');
					ordersList.innerHTML = '';
					userOrders.forEach(order => {
						fetch(`http://localhost:3000/foods/single/${order.foodId}`)
							.then(res => res.json())
							.then(food => {
								const li = document.createElement('li');
								li.className = 'order-item';
								li.innerHTML = `
									<img src="./img/${food.foodName.toLowerCase()}.jpeg">
									<div>
										<span class="order-name">${food.foodName}</span>
										<span class="order-count">${order.count}</span>
									</div>
								`;
								ordersList.appendChild(li);
							});
					});
				})
				.catch(error => console.error('Error fetching orders:', error));
		}

		// Fetch and populate foods select
		fetch('http://localhost:3000/foods/all')
			.then(response => response.json())
			.then(foods => {
				const foodsSelect = document.getElementById('foodsSelect');
				foodsSelect.innerHTML = ''; // Clear mock options
				foods.forEach(food => {
					const option = document.createElement('option');
					option.value = food.id;
					option.textContent = food.foodName;
					foodsSelect.appendChild(option);
				});
			})
			.catch(error => console.error('Error fetching foods:', error));

		// Handle user add form
		document.getElementById('userAdd').addEventListener('submit', (e) => {
			e.preventDefault();
			const name = document.getElementById('usernameInput').value;
			const phone = document.getElementById('telephoneInput').value;
			const user = { name, phone };
			fetch('http://localhost:3000/users', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify(user)
			})
			.then(response => response.json())
			.then(data => {
				console.log('User added:', data);
				// Refresh users list
				location.reload();
			})
			.catch(error => console.error('Error adding user:', error));
		});

		// Handle foods form (assuming it's for orders)
		document.getElementById('foodsForm').addEventListener('submit', (e) => {
			e.preventDefault();
			const foodId = document.getElementById('foodsSelect').value;
			const count = document.getElementById('foodsCount').value;
			const userId = parseInt(document.getElementById('clientId').textContent);
			const order = { userId, foodId: parseInt(foodId), count: parseInt(count) };
			fetch('http://localhost:3000/orders', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify(order)
			})
			.then(response => response.json())
			.then(data => {
				console.log('Order added:', data);
				// Refresh or update orders display
			})
			.catch(error => console.error('Error adding order:', error));
		});
	</script>
</body>
</html>